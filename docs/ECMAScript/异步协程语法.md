
# 异步协程语法

从ES8开始ECMAScript正式支持异步协程语法,使用关键字`async/await`来声明异步,其语义和用法与python中的一致.Promise作用相当于python中的Future.

本质来说`async/await`是一种用于处理JS异步操作的语法糖,可以帮助我们利用同步语法使用Promise,从而编写更加优雅的代码.

不过js的协程语法不用配合显式的声明事件循环.js的事件循环是隐式的.以异步访问为例:


```javascript
import fetch from 'node-fetch'
async function testAsync(){
    try{
        let response = await fetch(
            'http://www.baidu.com',
            {
                method: 'GET', 
            }
        )
        if (response.ok){
            let content = await response.text()
            console.log(content.slice(0,100))
        }else{
            console.error("http code error")
        }
    }catch(e){
       console.error(error)
    }
}
testAsync()
```

    <!DOCTYPE html><!--STATUS OK--><html><head><meta http-equiv="Content-Type" content="text/html;charse


## 异步迭代器

从ES9开始ECMAScript正式支持异步迭代器语法,功能上讲和python的异步迭代器一致,但语法不同,js中使用语法

```js
for await( let x of AsyncIterator) {
      ...
}
```

其中`AsyncIterator`就是异步迭代器,只要迭代器的next方法返回的是一个Promise实例就是异步迭代器.


```javascript
let promises = [1,2,3,4,5].map(i=>Promise.resolve(i))
```


```javascript
(async ()=>{
    for await (let p of promises){
        console.log(p)
    }
})()
```

    1
    2
    3
    4
    5

