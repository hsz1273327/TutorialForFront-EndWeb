# Javascript攻略

Javascript是当今最流行的编程语言之一,它诞生于网络技术,也几乎局限于网络技术.这是一门比较有争议的脚本语言.
一方面它相当简陋,在es6之前身为一个脚本语言其编程体验极差,
另一方面由于google的v8引擎和基于v8的node.js解释器的出现.js从只能做前端开发的浏览器脚本语言蜕变为全平台脚本语言.这让大量的前端开发者招到了新玩具从而迅速获得了一个极为庞大的社区.

在社区扩大后也涌现了一大批优秀的框架工具.事实上JS恐怕拥有着最大的编程社区,技术的更新换代恐怕也是所有语言中最快的.喜欢新鲜事物的人自然很喜欢这种状态,但这也让JS社区成了最碎片化的社区.
甚至于js也成了我见过唯一需要"编译"的脚本语言.

## Javascript的定位

JS的定位在历史上也是起起落落.最开始单纯作为浏览器脚本语言,到后来node.js出现一度有了JS成为前后端通用语言,拳打Java脚踢C,甚至因为其解释器很小资源消耗很低的特点还有了在嵌入式系统中应用的尝试,再到近年回归理性,基本确定了其应用范围就在前端和与前端相关的一些脚本小工具上.

结合JS这门语言的特点这个定位相对还是比较理性客观的.首先浏览器前端脚本是js的自留地,其他语言基本完全没有插足的余地;其次,在语言特性层面,js出了名的语法糖多,我们使用它写前端业务逻辑可以相当精简优雅;再次,从vm实现上来说,js天生为单线程而生,自带异步语法,可以轻松的在浏览器中调用远程接口的同时不影响页面渲染;最后,虽然node.js的出现让js有了脱离浏览器的能力,但毕竟脚本语言,虽然它确实性能不错内存消耗也小,但这也只是和其他脚本语言比较而言,和传统的编译语言相比依旧没有优势,而且和python一样天生有gil,而且无法利用多核,在高负载情况下只能通过起多个进程的方式,因此js天生不适合做高要求的网络组件开发.而许多方便前端开发的工具脚手架又都是node程序,因此node又是无法摆脱的一个部分.

## Javascript在网络前端中的地位

可以这么说,Javascript在现在的网络前端工程中处于核心地位.css和html可以理解成是js的周边资源.而在广义上的网络前端开发比如小程序开发中,像html和css都会被替换成平台提供的类似资源.可以说做网络前端开发最核心的点就是玩转Javascript.

## Javascript的现状

实际上Js是一个非常分裂的语言.它的主干[ECMAScript](https://baike.baidu.com/item/ECMAScript/1889420?fr=aladdin)是一个不断发展更新也非常有活力的语言,同时也是浏览器唯一默认支持的脚本语言,因此一般也称它为`javascript`.但由于其早期设计过于坑爹,加上node环境的崛起,就诞生了许多方言,他们的源码无法直接在js的执行环境中使用,需要通过编译器将源码转成js代码,最知名的就是[coffeescript](http://coffee-script.org/)和[TypeScript](https://www.tslang.cn/docs/home.html),这两者都有很大的用户群体.但由于ECMAScript的更新(目前已经到了es8)慢慢coffeescript变得不再流行,而由于typescript有类型标注等有益于工程化的特性,typescript越来越被大厂和各大前端框架青睐,似乎有取代ECMAScript的趋势.同时由于ECMAScript的标准发展太快,其运行平台在特性实现上并没有跟上,就造成了高版本的ECMAScript也需要通过编译器将源码转为低版本的ECMAScript代码,就诞生了[babel项目](https://www.babeljs.cn/)(ps:babel意为巴别塔,可想而知ECMAScript内部有多乱).所以与其说js是一种编程语言不如说是一个语系.

而在应用方面,也是非常分裂.但大体可以分为两个环境--浏览器和[node.js](https://nodejs.org/en/)其内部虚拟机(也叫引擎)具体实现又各用个的,下面是比较常见的js虚拟机:

+ `V8`开源,由Google开发,用C++编写,目前chrome和node.js使用
+ `Rhin`由Mozilla基金会开源,完全用Java开发
+ `SpiderMonkey`第一个JavaScript引擎,Netscape Navigator,Firefox
+ `JavaScriptCore`苹果公司为Safari开发
+ `KJS`最初由Harri Porten为KDE项目的Konqueror网络浏览器开发
+ `Chakra** (JScript9)`微软为Edge开发
+ `Chakra** (JavaScript)`微软为IE9到11开发
+ `Nashorn`作为OpenJDK的一部分,由Oracle Java语言和工具组编写
+ `JerryScript`一个物联网的轻量级引擎

虚拟机的实现不同问题倒不算大,问题大的部分主要是执行环境,由于不同执行环境下默认导入的模块不一样,标准库也不一样,因此可能都是js的包,但有的包只能node环境用,有的只能浏览器用.因此js在方方面面看都是相当割裂的一种编程语言.

## 使用的编程语言

本文将使用两种编程语言:

+ ES6+
+ TypeScript

这两者在很大程度上语法相当接近,TypeScript可以看做是ES6+带类型约束的超集,本文直接从ES6标准开始,绕开语法晦涩的低级标准,可以更好的服务于快速原型开发和结论验证.
es6非常适合快速原型开发,而typescript非常适合工程化.

在应用部分我们会将两种语言的代码都附上

+ 语法糖丰富

低版本的Js语法简单而且坑多,使用起来各种不方便,会给习惯python的数据科学研究人员造成学习困难, ES6新增了大量语法糖.在使用上可以给被python惯坏了的人一定程度上减少学习成本.

+ 接近Python的开发习惯

Python是模块化编程的语言,而Js在设计初期就没考虑模块化的问题,低版本的js在编写时模块化方面 会让被python惯坏了的人非常不喜欢,ES6使用类似python的import语句,相对容易接受.

## 文章结构

单说JavaScript的话是一个很简单的语言,本文大致分为几个部分

1. Node执行环境和工具链

    工欲善其事必先利其器,js作为后起之秀有着相当优秀和完善的工具链,但前面也讲过了社区非常碎片化因此不少工具功能相同,这对选择困难症非常不友好.
    这部分讲比较推荐的工具链,这些工具都是ecmascript和Typescript都可以使用的.

    1. babel编译器
    2. typescript编译器
    3. log工具
    4. 代码风格规范
    5. 测试工具
    6. 注释文档

2. Ecmascript
    介绍以es6为基础的js语法,主要是从实用角度出发,并不是语言手册

3. Typescript
    通过对ecmascript语法的补充介绍TypeScript.

4. 番外:node环境构建应用

    本篇作为番外只是作为补充,感兴趣的可以进一步深入.node提供了让js脱离服务器运行的能力,本篇将介绍这种能力的具体应用



