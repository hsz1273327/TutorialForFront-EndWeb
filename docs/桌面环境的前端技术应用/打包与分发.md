# 打包分发

好了我们已经有一个最简单的electron应用了,让我们来打包它.

在`electron-vite`中我们通常使用[Electron Builder](https://github.com/electron-userland/electron-builder).维护打包行为的有:

+ `electron-builder.yml`,electron-builder的配置文件
+ `package.json`,提供`npm run build:win`,`npm run build:mac`,`npm run build:linux`三个命令对应三个平台用于打包对应内容

我们以`build:linux`来看看究竟是怎么打包的

`build:linux`实际执行的操作是`npm run build && electron-builder --linux`,而`npm run build`实际执行的是`npm run typecheck && electron-vite build`,第一步是做类型检查,这个略过,第二步是`electron-vite build`,它会将源码编译到`out`文件夹.所以`electron-builder --linux`就是将`out`文件夹中的内容打包为electron应用.

## 配置electron-builder

配置使用yaml格式,其基本结构是:

1. 项目打包的基本元信息
2. 不同平台元信息和目标格式
3. 目标格式打包配置
4. 循环2,3两块

### 项目打包基本元信息

```yaml
appId: com.electron.app # 应用id
productName: helloworld # 项目名
directories:            
  buildResources: build # 打包时静态资源存放的位置,这个
files: # 打包的内容
  - '!**/.vscode/*'
  - '!src/*'
  - '!electron.vite.config.{js,ts,mjs,cjs}'
  - '!{.eslintignore,.eslintrc.cjs,.prettierignore,.prettierrc.yaml,dev-app-update.yml,CHANGELOG.md,README.md}'
  - '!{.env,.env.*,.npmrc,pnpm-lock.yaml}'
  - '!{tsconfig.json,tsconfig.node.json,tsconfig.web.json}'
asarUnpack: # 不打包进asar的内容
  - resources/**
...
npmRebuild: false #设置是否重新编译原生Node.js模块
publish: # 定义 Electron 应用程序的发布方式,包括更新方式
  provider: generic
  url: https://example.com/auto-updates
electronDownload: # 指定 Electron 二进制文件的下载源,该配置项主要影响 Electron 在构建过程中下载所需的依赖文件的位置
  mirror: https://npmmirror.com/mirrors/electron/
```

#### asar

asar可以理解为一个打包后的应用运行的一个特殊压缩格式,这是一个独立的虚拟文件系统并且大多数API都可以正常执行,但类似一些图片,二进制文件,原生依赖等就不能打包进asar,否则会在访问时有问题.

#### 重新编译node模块

`npmRebuild`设置项用于控制 Electron Builder是否在构建应用程序时重新编译原生Node.js模块.
Electron应用程序有时会依赖于一些原生模块(Native Modules),这些模块需要与Electron的特定版本进行编译以确保兼容性.设置为`true`的情况下Electron Builder会尝试重新编译这些模块以避免因版本不匹配而导致的运行时错误.

### linux应用配置

打包linux应用需要linux环境我们可以配置配置文件中对应的项目

```yaml
linux:
  target: # 编译不目标,支持AppImage,snap,deb,rpm等,个人推荐直接AppImage
    - AppImage
  maintainer: electronjs.org # 
  category: Utility
appImage:
  artifactName: ${name}-${version}.${ext}
```



### macos应用配置

### windows应用配置


## 跨平台

打包就涉及到跨平台了,如果我们希望跨平台打包,有两种方式

1. 借助cicd平台,比如最常用的可以借助GitHub Action.
2. 搞一台mac,用它自身打包mac版,再借助docker打包linux版本和windows版本