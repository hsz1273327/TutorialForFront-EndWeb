# Chrome扩展

Chrome是当今最流行的浏览器,而其可定制性也非常强,一些软件也依附于其上形成了一个生态.比如google自家的office套件就有chrome应用版本,像eth的钱包metamask也是一个chrome扩展.

Chrome的扩展基本上是web应用的延伸,完全兼容html5,因此开发成本相对很小--只要和web版本一起开发稍微改改就可以了;它也有一些独特的api和交互特性.许多服务在做好web版本后会"顺便"再做一份chrome扩展.

本系列文章将介绍Chrome扩展的基本概念并结合例子介绍不同类型的chrome该怎么构造.

## Chrome扩展的官方分类

Chrome将其平台上的程序分为扩展与应用,并且使用了同样的文件结构,那么两者的区别是什么呢?
在早期的Chrome版本中两者的区别非常模糊,而且有些扩展也可以用应用实现,反之亦然.
但今天看来Google正在努力使两者的界限变得清晰.现如今新应用已经不再允许进入官方市场,只能专供`chromeOs`.
这极大地限制了应用的使用范围.

本文将只介绍Chrome扩展,毕竟通常没啥人会用`ChromeOS`.

## 扩展可以有的组成部分

插件的组成部分包括

+ `service worker`,即插件的后台运行逻辑代码,各种什么右键菜单,commands,Omnibox的定义也都在里面
+ `popup`,即点击插件图标弹出的弹框页面
+ `options_page`,即插件的设置页面
+ `content_scripts`脚本,即匹配到url后执行的脚本
+ `美化页面`,即用于替换特定功能页的页面

这些组成部分并不是都必须存在,一般只要`service worker`,`popup`,`content_scripts`或`美化页面`有一个就可以了.

## 调试方法

要调试扩展可以按如下步骤操作:

1. 在chrome中选择`扩展程序=>管理扩展程序`(或者直接输入url<chrome://extensions/>)来进入插件管理界面.
2. 勾选`开发者模式`
3. 使用`加载已解压扩展程序`,选择项目根目录下有`manifest.json`的文件夹即可(例子中的`app`文件夹)

![调试和打包](./source/调试和打包.png)

要重载只要在要调试的插件位置点击`重新加载`就可以,要调试页面也只要点击其中的`背景页`就可以当一般的前端调试了.

## 发布项目

要发布项目有几个前提

1. 首先你得拥有谷歌开发者账号,这个账号可以直接用谷歌邮箱申请.
2. 你的账号需要开通两步认证

当然了上面两步的前提都是你得能先翻墙出去.在完成了上面的前提设置后我们可以登录自己的[Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole/),在`内容->上传新内容`中上传zip压缩好的项目文件就可以创建一个应用的发布草稿.

![上传应用](./source/上传应用.png)

我们在这个草稿中填写好相关的信息就可以提交审核申请了

![提交审核](./source/提交审核.png)

一旦审核通过我们的应用就可以在chrome应用商店中被找到了

## 单独打包分发

并不是所有的开发者都能直接在chrome商店更新扩展的.如果没有条件使用chrome应用商店分发或者只是希望小范围内分发可以通过在chrome扩展页点击`打包扩展程序`,然后选中你的项目(根目录下有`manifest.json`的文件夹)然后点击`打包应用程序`就可以获得到一个以`.crx`结尾的文件和一个以`.pem`的文件.其中`.crx`就是扩展,`.pem`则是应用程序的签名.

***需要注意这样的扩展如果没有在应用商店中注册也是无法使用的***,因此这种方式更加适合一些已经注册过的扩展项目做小范围版本测试.

如果我们的这个插件没有注册也要进行分发,那就基本只能直接分发源码文件了.
