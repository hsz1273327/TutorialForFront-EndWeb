# 资源设置

原生应用和web应用在形式上最大的不同在于原生应用调用的是自己打包好的在本地的资源;而web应用则更多的是借助网络现拉取资源到本地或者直接使用网络上的资源.

在nativescript项目中我们通常都是把用到的资源都放在源码中然后再打包的,这些资源包括:

+ 图片
+ 字体(Font)
+ 图标(Icon)

## 图片设置

很多时候我们的应用都是由图片堆叠而成的,比如logo是图片,开屏页是图片,各种ui元素也都可以是图片.nativescript中本地图片可以来自于:

+ 已注册的图片资源
+ 未注册的本地图片

### 已注册的图片资源

已注册的图片资源是最通用的图片资源,我们几乎可以在程序的任何位置使用它们.所谓注册图片资源简单理解就是将同一图片的不同分辨率副本放置到不同平台的指定文件夹下.
注意nativescript只支持`png`和`jpg`两种格式的图片作为注册资源.

注册的步骤如下:

1. 找到一张要作为图标的图片,假设文件名为`ic_myicon.png`.
2. 打开ps或者gimp,修改他们满足不同平台对图片的要求,并将其按格式命名后放入对应位置,我们以标准图标尺寸为例:
   1. android平台下
        | 分辨率    | 基准  | 适用设备范围          | 文件命名        | 存放文件夹                                            |
        | --------- | ----- | --------------------- | --------------- | ----------------------------------------------------- |
        | `36x36`   | 0.75x | 低密度屏ldpi          | `ic_myicon.png` | `App_Resources/Android/src/main/res/drawable-ldpi`    |
        | `48×48`   | 1.0x  | 中密度屏mdpi          | `ic_myicon.png` | `App_Resources/Android/src/main/res/drawable-mdpi`    |
        | `72x72`   | 1.5x  | 高密度屏hdpi          | `ic_myicon.png` | `App_Resources/Android/src/main/res/drawable-hdpi`    |
        | `96x96`   | 2.0x  | 超高密度屏xhdpi       | `ic_myicon.png` | `App_Resources/Android/src/main/res/drawable-xhdpi`   |
        | `144x144` | 3.0x  | 超超高密度屏xxhdpi    | `ic_myicon.png` | `App_Resources/Android/src/main/res/drawable-xxhdpi`  |
        | `192x192` | 4.0x  | 超超超高密度屏xxxhdpi | `ic_myicon.png` | `App_Resources/Android/src/main/res/drawable-xxxhdpi` |

   1. ios平台下
        | 分辨率    | 基准 | 适用设备范围                          | 文件命名        | 存放文件夹                                           |
        | --------- | ---- | ------------------------------------- | --------------- | ---------------------------------------------------- |
        | `40x40`   | 1.0x | iPhone 3GS(含)之前,iPad2(含)之前      | `ic_myicon.png` | `App_Resources/iOS`   |
        | `80x80`   | 2.0x | iPhone 6s(含)之前,iPad mini 4(含)之前 | `ic_myicon@2x.png` | `App_Resources/iOS`  |
        | `120x120` | 3.0x | 超超高密度屏xxhdpi                    | `ic_myicon@3x.png` | `App_Resources/iOS` |

之后要在应用中使用则只需要使用路径`res://ic_myicon`即可

### 未注册的本地图片

通常我们只需要将其放在`app`文件夹下即可被找到,注意nativescript只支持`png`和`jpg`两种格式的图片.我个人习惯上会创建文件夹`source/img`存放图片文件.

使用的时候直接以`app`文件夹作为根目录使用绝对路径即可.

## 字体设置

通常来说默认字体已经够用.nativescript默认提供了3种通用字体:

+ `serif` (ex. Times New Roman)
+ `sans-serif` (ex. Helvetica)
+ `monospace` (ex. Courier New)

在ios下我们还可以使用ios默认提供的字体,我们可以在[这个网址](http://iosfonts.com/)中查到不同的sdk中的范围.

如果要自定义字体,则需要将对应的`.ttf`或者`.otf`文件放在`app/fonts/`路径下(在iOS上字体文件应与字体名称完全相同)

我们可以在项目根目录下使用`ns fonts`查看当前使用的自定义字体

### 使用字体

`css`的`font-family`属性可以用设置使用的字体

```css
font-families: serif;
```

## 图标设置

在nativescript中我们使用的图标可以是3种来源:

1. 系统图标
2. 注册图片资源作为图标
3. 字体图标

### 系统图标

我们可以在特定位置使用系统自带图标.这些位置都包含属性`ios.systemIcon`和`android.systemIcon`

+ [android的图标在这里查看](https://developer.android.com/reference/android/R.drawable.html),其中`ic_`开头的就是可以用的
+ ios的图标目前还未找到查看位置

nativescript中自定义图标实际就是字体,默认提供了[fontawesome 5中brands,solid,regular三种图标](https://fontawesome.com/v5/search?s=brands)
这三种图标都放在`app/fonts/`中,对应`fa-brands-400.ttf`,`fa-solid-900.ttf`和`fa-regular-400.ttf`.官方还推荐了[icomoon](https://icomoon.io/)

### 注册图片资源作为图标

一些位置提供`src`属性的就可以使用注册图片资源作为图标,一般形式为`src="res://ic_myicon"`.如果指定的图片并未注册则会展示位空白

### 字体图标

字体图标并不是所有组件都可以使用,一般组件中有`text`,`icon`属性的组件以及部分支持`src.decode`属性的组件才可以使用.其使用步骤可以归结为

1. 下载想要的图标,找出其中的`.ttf`文件,放到`app/fonts/`目录下
2. 在`app/app.css`或者`app/app.scss`中添加对图标的类型声明

    ```css
    .fa-brands {
        font-family: "Font Awesome 5 Brands", "fa-brands-400";
    }
    ```

3. 按照图标字体网页上的说明确定每个字体字形的十六进制代码.这里有两种情况
    1. 叫unicode的一般是一个长度为4的字符串,用的时候前面加上`\u`,比如unicode为`e903`,则用的时候为`\ue903`
    2. 有的叫entity,其样子为`&#xe800;`

    将上面的16进制代码在组件中用法有如下几种:

    1. 组件如果有`text`字段且支持使用图标位则可以将上面的16进制代码直接写在`text`的值位置,并使用class指定定义的类,这个`text`字段的值只能由变量或函数提供,字面量不会生效
    2. 组件如果有`icon`字段则可以使用`font://<上面的16进制代码>`作为`icon`的值,并使用class指定定义的类,这个`icon`字段的值只能由变量或函数提供,字面量不会生效
    3. 在`Image`组件中可以使用`src.decode="<上面的16进制代码>"`作为图片的路径,并使用class指定定义的类,这个`src.decode`字段的值只能由变量或函数提供,字面量不会生效

#### 在nativescript-vue中使用npm中打包好的图标(推荐)

materialdesignicons是一个非常流行的图标库,npm中叫[@mdi/font](https://github.com/Templarian/MaterialDesign-Webfont),我们可以安装它来获取它支持的图标.

```bash
npm install @mdi/font
```

nativescript中并不能直接支持用这种库,我们需要在webpack层做一些修改,这样就可以使用了

+ 原本的`webpack.config.js`

    ```js
    const webpack = require("@nativescript/webpack");

    module.exports = (env) => {
        webpack.init(env);

        // Learn how to customize:
        // https://docs.nativescript.org/webpack

        return webpack.resolveConfig();
    };
    ```

+ 修改后的`webpack.config.js`

    ```js
    const webpack = require("@nativescript/webpack");
    const NsVueTemplateCompiler = require('nativescript-vue-template-compiler');
    const { readFileSync } = require('fs');
    const CopyWebpackPlugin = require('copy-webpack-plugin');

    const { resolve } = require('path');
    function fixedFromCharCode(codePt) {
        if (codePt > 0xffff) {
            codePt -= 0x10000;
            return String.fromCharCode(0xd800 + (codePt >> 10), 0xdc00 + (codePt & 0x3ff));
        } else {
            return String.fromCharCode(codePt);
        }
    }

    // temporary hack to support v-model using ns-vue-template-compiler
    // See https://github.com/nativescript-vue/nativescript-vue/issues/371
    NsVueTemplateCompiler.registerElement('MDTextField', () => require('@nativescript-community/ui-material-textfield').TextField, {
        model: {
            prop: 'text',
            event: 'textChange'
        }
    });
    NsVueTemplateCompiler.registerElement('MDTextView', () => require('@nativescript-community/ui-material-textview').TextField, {
        model: {
            prop: 'text',
            event: 'textChange'
        }
    });
    NsVueTemplateCompiler.registerElement('MDSlider', () => require('@nativescript-community/ui-material-slider').Slider, {
        model: {
            prop: 'value',
            event: 'valueChange'
        }
    });

    module.exports = (env) => {
        webpack.init(env);
        const platform = env && ((env.android && 'android') || (env.ios && 'ios'));
        webpack.chainWebpack((config) => {
            const symbolsParser = require('scss-symbols-parser');
            const mdiSymbols = symbolsParser.parseSymbols(readFileSync(resolve(__dirname, 'node_modules/@mdi/font/scss/_variables.scss')).toString());
            const mdiIcons = JSON.parse(`{${mdiSymbols.variables[mdiSymbols.variables.length - 1].value.replace(/" (F|0)(.*?)([,\n]|$)/g, '": "$1$2"$3')}}`);

            const scssPrepend = `$mdi-fontFamily: ${platform === 'android' ? 'materialdesignicons-webfont' : 'Material Design Icons'};`;
            config.module.rule('scss').use('sass-loader').options({
                additionalData: scssPrepend
            });
            config.module
                .rule('replace_mdi')
                .exclude.add(/node_modules/)
                .end()
                .test(/\.(ts|js|scss|css|vue)$/)
                .use('string-replace-loader')
                .loader(resolve(__dirname, 'node_modules/string-replace-loader'))
                .options({
                    search: 'mdi-([a-z0-9-_]+)',
                    replace: (match, p1, offset, str) => {
                        if (mdiIcons[p1]) {
                            return fixedFromCharCode(parseInt(mdiIcons[p1], 16));
                        }
                        return match;
                    },
                    flags: 'g'
                });
            config.plugin('material-font').use(CopyWebpackPlugin, [
                {
                    patterns: [
                        {
                            from: resolve(__dirname, 'node_modules/@mdi/font/fonts/materialdesignicons-webfont.ttf'),
                            to: 'app/fonts'
                        }
                    ]
                }
            ]);
        });
        return webpack.resolveConfig();
    };
    ```

webpack会将图标库中的对应`.ttf`文件复制到`app/fonts`下(如果没有复制成功可以手工复制下),提供一个`$mdi-fontFamily`用于设置fontfamily,并提供字符串用于指代图标名

使用方法如下:

1. 在`app.css`或者`app.scss`中添加对图标申明

   ```css
   .mdi {
    font-family: $mdi-fontFamily;
    }
   ```

2. 调用时形式和标准方式一样,只是将*16进制代码*替换为了*mid-<图标名>*,图标名可以去[这里查](https://materialdesignicons.com/),使用的时候查到的比如说是`clipboard-account`,用的时候就写成`mdi-clipboard-account`.

这个方法目前我只在mid这个库上用过,其他的图标库应该也可以用类似原理设置.个人建议在一个app中只用一套图标,减小空间也降低维护成本.

亲测标准方式可用性很差,因此推荐只用这种方式维护图标,本文后续也将以这种方式为基准.